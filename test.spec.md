# Reflow Accessibility Test Spec

## 背景
本プロジェクトでは **Playwright (@playwright/test)** と **Bun** ランタイムを用いて、WCAG 2.2 の達成基準 *1.4.10 Reflow* を満たすことを目的としたリフロー(レイアウト再構成)テストを自動化します。

## テスト対象
- フロントエンド SPA (URL は `.env` の `BASE_URL` に設定)
- 対象ページは `/` (トップページ) と、主要導線で遷移可能な各コンテンツページ

## 前提条件
1. Bun v1.0 以降がインストール済み
2. `@playwright/test` と `axe-playwright` が開発依存として追加済み
3. .env ファイルに `BASE_URL` が定義されている

## テスト環境セットアップ (概要)
```bash
bun install
bunx playwright install --with-deps
```

## シナリオ一覧
| ID | シナリオ | 詳細 | 期待結果 |
|----|----------|------|----------|
| RF-01 | ビューポート幅 1280→320 にリサイズ | 1. 1280×800 でページをロード <br>2. 320×800 にリサイズ | • 水平スクロールバーが表示されない <br>• 主要コンテンツが欠落しない |
| RF-02 | テキストサイズ 100%→200% 拡大 | 1. ページをロード <br>2. `html { font-size: 200%; }` を注入 | • 水平スクロールバーが表示されない <br>• 文字が重ならない・途切れない |
| RF-03 | ビューポート幅 320 でテキスト200% | RF-01 と RF-02 を組み合わせ | • 同上 |
| RF-04 | 動的コンテンツ挿入によるリフロー | 1. ページで動的 UI (モーダル/アコーディオン等) を開く | • 表示中要素のフォーカス順序が保持される <br>• 水平スクロールが発生しない |
| RF-NEW | デスクトップ幅でテキストサイズ 200% 拡大 | 1. デスクトップ幅でページをロード <br>2. `html { font-size: 200%; }` を注入 | • 水平スクロールバーが表示されない <br>• 文字が重ならない・途切れない |

## 共通テストステップ (Playwright)
1. 環境変数 `BASE_URL` からページを起動
2. (必要に応じて) アクセシビリティツールによる解析を実行
3. ビューポート・文字サイズを変更
4. 以下のアサーションを取る
   - `page.evaluate(() => document.body.scrollWidth <= window.innerWidth)` が `true`
   - ページタイトル・主要ランドマークが DOM に存在
5. 失敗時はスクリーンショットを自動保存

## レポート要件
- Playwright HTML レポートを生成し、GitHub Actions の成果物としてアップロード
- 失敗ケースは動画キャプチャおよび diff スクリーンショットを残す

## 今後の拡張
- コンポーネント単位の Storybook + Storybook テストランナーによるリフローテスト
- `@playwright/experimental-ct-react` によるユニットレベルのリフロー検証

---

> 注記: 本 spec は初版です。実装フェーズでページ構造や要件変更が発生した場合は随時更新してください。 